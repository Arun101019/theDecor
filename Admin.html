<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - The Decor Edits</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background-color: #0d1117;
      color: #e6edf3;
      font-family: 'Poppins', sans-serif;
    }
    .navbar { background-color: #161b22; border-bottom: 1px solid #30363d; }
    .navbar-brand { color: #1f6feb !important; font-weight: 600; }
    .form-control, .form-select {
      background-color: #0d1117;
      color: #e6edf3;
      border: 1px solid #30363d;
    }
    .card {
      background-color: #161b22;
      border: 1px solid #30363d;
      border-radius: 10px;
      padding: 20px;
    }
    .btn-primary { background-color: #1f6feb; border: none; }
    .btn-primary:hover { background-color: #388bfd; }
  </style>
</head>

<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark">
  <div class="container-fluid px-4">
    <a class="navbar-brand" href="#">‚öôÔ∏è Admin - The Decor Edits</a>
  </div>
</nav>

<div class="container mt-5">
  <h2 class="text-info mb-4 text-center">üõçÔ∏è Add New Product</h2>

  <div class="card shadow">
    <form id="productForm">
      <div class="mb-3">
        <label class="form-label">Product Name</label>
        <input type="text" id="pname" class="form-control" required>
      </div>

      <div class="mb-3">
        <label class="form-label">Description</label>
        <textarea id="pdesc" class="form-control" rows="3" required></textarea>
      </div>

      <div class="mb-3">
        <label class="form-label">Price (‚Çπ)</label>
        <input type="number" id="pprice" class="form-control" required>
      </div>

      <div class="mb-3">
        <label class="form-label">Main Image</label>
        <input type="file" id="mainImgFile" class="form-control" accept="image/*" required>
      </div>

      <div class="mb-3">
        <label class="form-label">Other Images (optional)</label>
        <input type="file" id="otherImgsFile" class="form-control" accept="image/*" multiple>
      </div>

      <div class="mb-3">
        <label class="form-label">Amazon / Flipkart Link</label>
        <input type="url" id="plink" class="form-control" placeholder="https://amazon.in/...">
      </div>

      <button type="submit" class="btn btn-primary w-100">üíæ Save Product</button>
    </form>
  </div>

  <div class="mt-5">
    <h4 class="text-info mb-3">üßæ All Saved Products</h4>
    <div id="productList" class="row g-4"></div>
  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
  // Import Firebase functions
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-storage.js";

  // Firebase configuration (from your console)
  const firebaseConfig = {
    apiKey: "AIzaSyDRVCbBDzuqIG2mYBLDirReunh4oLJa5Wk",
    authDomain: "thedecor-6d3f4.firebaseapp.com",
    projectId: "thedecor-6d3f4",
    storageBucket: "thedecor-6d3f4.firebasestorage.app",
    messagingSenderId: "993017983175",
    appId: "1:993017983175:web:3d5fcb9977236aa84b8ee2",
    measurementId: "G-YT7CBME3LK"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  const form = document.getElementById("productForm");
  const list = document.getElementById("productList");

  async function uploadImage(file, folder = "products") {
    const fileRef = ref(storage, `${folder}/${Date.now()}_${file.name}`);
    await uploadBytes(fileRef, file);
    return await getDownloadURL(fileRef);
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const name = document.getElementById("pname").value.trim();
    const desc = document.getElementById("pdesc").value.trim();
    const price = parseFloat(document.getElementById("pprice").value);
    const link = document.getElementById("plink").value.trim();
    const mainFile = document.getElementById("mainImgFile").files[0];
    const otherFiles = Array.from(document.getElementById("otherImgsFile").files);

    if (!mainFile) {
      alert("Main image is required!");
      return;
    }

    try {
      // Upload main image
      const mainImageUrl = await uploadImage(mainFile);
      const extraUrls = [];
      for (const f of otherFiles) {
        const u = await uploadImage(f);
        extraUrls.push(u);
      }

      // Save product in Firestore
      await addDoc(collection(db, "products"), {
        name, desc, price, link,
        mainImage: mainImageUrl,
        extraImages: extraUrls,
        createdAt: new Date()
      });

      alert("‚úÖ Product added successfully!");
      form.reset();
      loadProducts();
    } catch (err) {
      console.error(err);
      alert("‚ùå Error adding product: " + err.message);
    }
  });

  async function loadProducts() {
    list.innerHTML = "<p class='text-center text-secondary'>Loading...</p>";
    const snapshot = await getDocs(collection(db, "products"));
    list.innerHTML = "";

    if (snapshot.empty) {
      list.innerHTML = "<p class='text-center text-secondary'>No products found.</p>";
      return;
    }

    snapshot.forEach(doc => {
      const p = doc.data();
      list.innerHTML += `
        <div class="col-md-4">
          <div class="card h-100 text-center">
            <img src="${p.mainImage}" class="img-fluid rounded mb-2" style="height:200px; object-fit:cover;">
            <h5 class="text-warning">${p.name}</h5>
            <p class="text-light">‚Çπ${p.price}</p>
            <a href="${p.link}" target="_blank" class="btn btn-sm btn-success mb-2">üõí View Link</a>
          </div>
        </div>`;
    });
  }

  // Load products on start
  loadProducts();
</script>

</body>
</html>
